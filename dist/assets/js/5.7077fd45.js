(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{140:function(t,e,s){t.exports=s.p+"assets/img/init.77065943.png"},141:function(t,e){t.exports="data:image/png;base64,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"},148:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_0-搭建环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-搭建环境"}},[t._v("#")]),t._v(" 0.搭建环境")]),t._v(" "),a("p",[t._v("镜像：ubuntu-18.04.3-live-server-amd64")]),t._v(" "),a("p",[t._v("身份：root（重要）")]),t._v(" "),a("p",[a("strong",[t._v("（有使用http代理和不代理两种选项，都可以走通，已测试）")])]),t._v(" "),a("h2",{attrs:{id:"_1-设置http代理【如不使用代理可跳过这一步】："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置http代理【如不使用代理可跳过这一步】："}},[t._v("#")]),t._v(" 1.设置http代理【如不使用代理可跳过这一步】：")]),t._v(" "),a("h3",{attrs:{id:"_1-1-curl代理配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-curl代理配置"}},[t._v("#")]),t._v(" 1.1 curl代理配置")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi ~/.curlrc\n# 加一行 proxy=http://xxx.xxx.xxx.xxx:xx\n# 然后curl 谷歌看是否正常\n")])])]),a("h3",{attrs:{id:"_1-2-docker代理配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-docker代理配置"}},[t._v("#")]),t._v(" 1.2 docker代理配置")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('mkdir /etc/systemd/system/docker.service.d\nvim /etc/systemd/system/docker.service.d/http-proxy.conf\n## 复制下面内容\n\n[Service]\nEnvironment="HTTP_PROXY=http://xxx.xxx.xxx.xxx:xx" "HTTPS_PROXY=http://xxx.xxx.xxx.xxx:xx"\n\n##\nsystemctl daemon-reload && systemctl restart docker\n')])])]),a("h2",{attrs:{id:"_2-设置apt代理【如使用阿里云服务器可跳过这一步】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置apt代理【如使用阿里云服务器可跳过这一步】"}},[t._v("#")]),t._v(" 2.设置apt代理【如使用阿里云服务器可跳过这一步】")]),t._v(" "),a("p",[t._v("使用阿里云的镜像：")]),t._v(" "),a("p",[t._v("(https://developer.aliyun.com/mirror)[https://developer.aliyun.com/mirror]")]),t._v(" "),a("p",[t._v("使用以下代码替换/etc/apt/sources.list的内容，替换前先备份（mv sources.list sources.list.bak）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse\n\n")])])]),a("p",[t._v("然后重启")]),t._v(" "),a("h2",{attrs:{id:"_3-安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装docker"}},[t._v("#")]),t._v(" 3.安装docker")]),t._v(" "),a("p",[t._v("官网下载教程:")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.docker.com/install/linux/docker-ce/ubuntu/"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("（以下代码保存为shell直接运行更快）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('sudo apt-get remove docker docker-engine docker.io containerd runc\nsudo apt-get update\nsudo apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\nsudo apt-key fingerprint 0EBFCD88\nsudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\nsudo apt-get update\nsudo apt-get install -y docker-ce docker-ce-cli containerd.io\n')])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 成功后看是否成功\ndocker --version\n# 然后设置开机自动启动docker\nsudo systemctl enable docker\n")])])]),a("h2",{attrs:{id:"_4-禁用swap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-禁用swap"}},[t._v("#")]),t._v(" 4 禁用swap")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("对于禁用swap内存，具体原因可以查看Github上的Issue：Kubelet/Kubernetes should work with Swap Enabled\n")])])]),a("p",[a("a",{attrs:{href:"https://github.com/kubernetes/kubernetes/issues/53533",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/kubernetes/kubernetes/issues/53533"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("若想永久关闭：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("sudo vim /etc/fstab")]),t._v(" "),a("p",[t._v("注释掉swap那一行")])]),t._v(" "),a("li",[a("p",[t._v("重启")])])]),t._v(" "),a("h2",{attrs:{id:"_5-安装kubelet-kubeadm-kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-安装kubelet-kubeadm-kubectl"}},[t._v("#")]),t._v(" 5.安装kubelet & kubeadm & kubectl")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("kubelet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("运行在cluster所有节点上"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("负责启动"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POD")]),t._v("和容器\nkubeadm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("用于初始化cluster\nkubectl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("kubectl是kubenetes命令行工具，通过kubectl可以部署和管理应用，查看各种资源，创建，删除和更新组件")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node节点其实可以不用安装"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_5-1-使用代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-使用代理"}},[t._v("#")]),t._v(" 5.1 使用代理")]),t._v(" "),a("p",[t._v("方案一（官方，配置过代理推荐使用这个）")]),t._v(" "),a("p",[t._v("来源：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://kubernetes.io/docs/tasks/tools/install-kubectl"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("（以下代码保存为shell直接运行更快）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('sudo apt-get update && sudo apt-get install -y apt-transport-https\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\necho "deb https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee -a /etc/apt/sources.list.d/kubernetes.list\nsudo apt-get update\nsudo apt-get install -y kubectl kubeadm kubelet\napt-mark hold kubelet kubeadm kubectl\n')])])]),a("p",[t._v("查看状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl status kubelet\n")])])]),a("p",[t._v("开机自启动")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl enable kubelet\n")])])]),a("h3",{attrs:{id:"_5-2-不使用代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-不使用代理"}},[t._v("#")]),t._v(" 5.2 不使用代理")]),t._v(" "),a("p",[t._v("方案二（如果没有使用代理）：")]),t._v(" "),a("p",[t._v("来源：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.aliyun.com/mirror/kubernetes?spm=a2c6h.13651102.0.0.53322f70H0yumO",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.aliyun.com/mirror/kubernetes?spm=a2c6h.13651102.0.0.53322f70H0yumO"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("apt-get update && apt-get install -y apt-transport-https\ncurl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - \n# 生成/etc/apt/sources.list.d/kubernetes.list文件加上一行即可\ncat <<EOF >/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\napt-get update\napt-get install -y kubelet kubeadm kubectl\napt-mark hold kubelet kubeadm kubectl\n")])])]),a("p",[t._v("查看状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl status kubelet\n")])])]),a("p",[t._v("开机自启动")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl enable kubelet\n")])])]),a("h2",{attrs:{id:"_6-获取kubeadm启动需要的镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-获取kubeadm启动需要的镜像"}},[t._v("#")]),t._v(" 6 获取kubeadm启动需要的镜像")]),t._v(" "),a("p",[t._v("方法一（使用了代理）：")]),t._v(" "),a("p",[t._v("如能翻墙则直接kubeadm config images pull")]),t._v(" "),a("p",[t._v("方法二（没有使用代理）：")]),t._v(" "),a("p",[t._v("运行")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("kubeadm config images list\n")])])]),a("p",[t._v("获取当前版本kubeadm启动需要的镜像，像这样")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("k8s.gcr.io/kube-apiserver:v1.17.0\nk8s.gcr.io/kube-controller-manager:v1.17.0\nk8s.gcr.io/kube-scheduler:v1.17.0\nk8s.gcr.io/kube-proxy:v1.17.0\nk8s.gcr.io/pause:3.1\nk8s.gcr.io/etcd:3.4.3-0\nk8s.gcr.io/coredns:1.6.5\n")])])]),a("p",[t._v("然后把前缀k8s.gcr.io/ 去掉 写个像下面这样的shell脚本运行一下，用阿里云的镜像替代谷歌的镜像。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#!/bin/bash\nimages=(\nkube-apiserver:v1.17.0\nkube-controller-manager:v1.17.0\nkube-scheduler:v1.17.0\nkube-proxy:v1.17.0\npause:3.1\netcd:3.4.3-0\ncoredns:1.6.5\n)\nfor i in ${images[@]};\ndo\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$i\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$i k8s.gcr.io/$i\ndone\n")])])]),a("h2",{attrs:{id:"_7-修改docker的cgroup驱动程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-修改docker的cgroup驱动程序"}},[t._v("#")]),t._v(" 7 修改docker的cgroup驱动程序")]),t._v(" "),a("p",[t._v('只能使用“systemd" 不然会报错')]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /etc/docker/daemon.json\n")])])]),a("p",[t._v("加一条")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"exec-opts":["native.cgroupdriver=systemd"]\n')])])]),a("p",[t._v("随后")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl restart docker\n")])])]),a("h2",{attrs:{id:"_8-直接克隆机器形成几个节点（省事）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-直接克隆机器形成几个节点（省事）"}},[t._v("#")]),t._v(" 8 直接克隆机器形成几个节点（省事）")]),t._v(" "),a("p",[t._v("此时可以直接克隆一下形成几个节点，因为此时的状态可以直接当作节点使用。")]),t._v(" "),a("p",[t._v("如果是虚拟机中布置 在当前状态直接克隆形成几个节点改一下"),a("strong",[t._v("hostname和ip地址")]),t._v("即可，可以省很多事。")]),t._v(" "),a("p",[t._v("如果是虚拟机的话 克隆之后修改一下"),a("strong",[t._v("节点的ip")]),t._v("（在ip许可范围内的都行，最简单的就在原来的ip上加1）")]),t._v(" "),a("p",[t._v("因为我这里是ens33 这里也可能是eth0")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 修改ip地址\nsudo ifconfig ens33 <新的ip地址>\nsudo systemctl restart network-manager\n\n# 修改主机名（改成啥样随意）\nvi /etc/hostname\n\n# 重启\nreboot\n")])])]),a("h2",{attrs:{id:"_9-启动（只在master节点）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-启动（只在master节点）"}},[t._v("#")]),t._v(" 9 启动（只在master节点）")]),t._v(" "),a("p",[t._v("ip地址用ip addr看本机的ip地址")]),t._v(" "),a("p",[t._v("kubernetes-version 就是前面kubeadm config images  看到的版本号，我这里是v1.17.0")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo kubeadm init --kubernetes-version=v1.17.0 --apiserver-advertise-address=<本机的ip地址>\n")])])]),a("p",[t._v("如图：init成功 ，以下图仔细看，token和ip地址要记住(如果忘了也没事）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 可以查看其他node join master时需要的token\nkubeadm token create --print-join-command\n")])])]),a("p",[a("img",{attrs:{src:s(140),alt:"1576251497470"}})]),t._v(" "),a("p",[t._v("验证是否启动成功：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("curl https://127.0.0.1:6443 -k\n")])])]),a("p",[t._v("正常结果：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "kind": "Status",\n  "apiVersion": "v1",\n  "metadata": {\n\n  },\n  "status": "Failure",\n  "message": "forbidden: User \\"system:anonymous\\" cannot get path \\"/\\"",\n  "reason": "Forbidden",\n  "details": {\n\n  },\n  "code": 403\n}\n')])])]),a("p",[t._v("随后")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n")])])]),a("h2",{attrs:{id:"_10-加入-node节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-加入-node节点"}},[t._v("#")]),t._v(" 10 加入(node节点)")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 在master上查看需要在node上运行的命令\nkubeadm token create --print-join-command\n\n# 在node上运行类似这种（不要复制黏贴 用上面查看获得的）\nkubeadm join 192.168.190.77:6443 --token zvj7eq.l5eenxi8ofhk3kxd \\\n    --discovery-token-ca-cert-hash sha256:49ceaed93cd973f6cd276cb036bd95333f4a70d7a6a588580b399fa3108002c4\n")])])]),a("h2",{attrs:{id:"_11-检验（在master节点上）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-检验（在master节点上）"}},[t._v("#")]),t._v(" 11 检验（在master节点上）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("kubectl get nodes\n")])])]),a("p",[t._v("这时可以看到3个NotReady的节点。 这是因为还没安装网络插件。")]),t._v(" "),a("p",[a("img",{attrs:{src:s(141),alt:"1576463452772"}})]),t._v(" "),a("h2",{attrs:{id:"_12-安装网络插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-安装网络插件"}},[t._v("#")]),t._v(" 12 安装网络插件")]),t._v(" "),a("p",[t._v("来源：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("选择weave net")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sysctl net.bridge.bridge-nf-call-iptables=1\nkubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\"\n")])])]),a("p",[t._v("然后等待")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("kubectl get pods --all-namespaces\n")])])]),a("p",[t._v("全是running即可")]),t._v(" "),a("p",[t._v("注：不加--all-namespaces则默认指明namespace=default 所以看不到")]),t._v(" "),a("h2",{attrs:{id:"_13-修改nodeport端口范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-修改nodeport端口范围"}},[t._v("#")]),t._v(" 13 修改nodeport端口范围")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vim /etc/kubernetes/manifests/kube-apiserver.yaml\n# 增加一行--service-node-port-range=1-65535\n# (修改完自动会更新，不需要其他操作)\n")])])]),a("p",[t._v("默认值为30000-32767，如果不修改的话使用ingress时对外暴露的接口80与443会随机使用另外两个范围内的值。")]),t._v(" "),a("h2",{attrs:{id:"_14-安装ingress-control"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-安装ingress-control"}},[t._v("#")]),t._v(" 14 安装ingress control")]),t._v(" "),a("p",[t._v("来源：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/installation.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/installation.md"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("kubectl apply -f common/ns-and-sa.yaml\nkubectl apply -f common/default-server-secret.yaml\nkubectl apply -f common/nginx-config.yaml\nkubectl apply -f common/custom-resource-definitions.yaml\nkubectl apply -f rbac/rbac.yaml\nkubectl apply -f daemon-set/nginx-ingress.yaml\n\n# 然后在nodeport.yaml文件中增加两个nodePort字段强制指向主机的80和443端口，而不是使用随机分配的端口\n")])])]),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ingress\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#新增")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#新增")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ingress\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("kubectl apply -f service/nodeport.yaml\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);