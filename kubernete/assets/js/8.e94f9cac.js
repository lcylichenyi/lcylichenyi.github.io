(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{147:function(e,t,a){"use strict";a.r(t);var s=a(0),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"如何移除节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何移除节点"}},[e._v("#")]),e._v(" 如何移除节点")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 在master上运行\n#封锁node，排干node上的pod\nkubectl drain <node名称> --delete-local-data --force --ignore-daemonsets\n# 等待状态变成SchedulingDisabled   \nkubectl get nodes\n# 删除节点\nkubectl delete node <node名称>\n\n# 在节点上运行\n# 脱离master\nkubeadm reset\n")])])]),a("h2",{attrs:{id:"dns存在问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns存在问题"}},[e._v("#")]),e._v(" DNS存在问题")]),e._v(" "),a("p",[e._v("（不推荐使用calico，我踩坑了还没解决，换了weaver才解决）")]),e._v(" "),a("p",[e._v("源：")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000015639327",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://segmentfault.com/a/1190000015639327"),a("OutboundLink")],1)]),e._v(" "),a("h2",{attrs:{id:"创建证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建证书"}},[e._v("#")]),e._v(" 创建证书")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 举个例子\nkubectl create secret tls <tls-secret的名称> --cert=<公钥pem文件> --key=<私钥key文件>\n")])])]),a("h2",{attrs:{id:"nginx-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[e._v("#")]),e._v(" nginx 配置")]),e._v(" "),a("p",[e._v("有两种配置，需要看nginx-ingress是哪个版本(一个是nginx.org/.... ，一个是nginx.ingress.kubernetes.io/...)")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/nginx-ingress-controllers.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/nginx-ingress-controllers.md"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("来源：")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/configmap-and-annotations.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/nginxinc/kubernetes-ingress/blob/master/docs/configmap-and-annotations.md"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/kubernetes/ingress-nginx/blob/master/docs/user-guide/nginx-configuration/annotations.md"),a("OutboundLink")],1)]),e._v(" "),a("h2",{attrs:{id:"安装dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装dashboard"}},[e._v("#")]),e._v(" 安装dashboard")]),e._v(" "),a("p",[e._v("来源：")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("下载https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml")]),e._v(" "),a("p",[e._v("自己改一下 修改kubernete-dashboard的service")]),e._v(" "),a("p",[e._v("增加")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[e._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("NodePort\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("nodePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8001")]),e._v("\n")])])]),a("p",[e._v("然后apply -f 运行一下 就能直接在外部访问。")]),e._v(" "),a("p",[e._v("访问的适合需要token")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl -n kube-system describe $(kubectl -n kube-system get secret -n kube-system -o name | grep namespace) | grep token\n")])])]),a("p",[e._v("源： "),a("a",{attrs:{href:"https://blog.csdn.net/weixin_34072458/article/details/89559852",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://blog.csdn.net/weixin_34072458/article/details/89559852"),a("OutboundLink")],1)]),e._v(" "),a("h2",{attrs:{id:"通过阿里云仓库拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过阿里云仓库拉取镜像"}},[e._v("#")]),e._v(" 通过阿里云仓库拉取镜像")]),e._v(" "),a("p",[e._v("源："),a("a",{attrs:{href:"https://www.jianshu.com/p/fd13c2762d81",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/fd13c2762d81"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl create secret docker-registry regsecret --docker-server=registry.cn-shanghai.aliyuncs.com --docker-username=name@1916434534983968 --docker-password=XXXXXXXX\n")])])]),a("p",[a("strong",[e._v("yml文件加入密钥参数")])]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" channel\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" registry.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("shanghai.aliyuncs.com/yin32167/channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.0")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8114")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("imagePullSecrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" regsecret\n")])])]),a("h2",{attrs:{id:"如何设置传输文件大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何设置传输文件大小"}},[e._v("#")]),e._v(" 如何设置传输文件大小")]),e._v(" "),a("p",[e._v("annotation中使用")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("nginx.org/client-max-body-size: 100m\n")])])]),a("p",[e._v("而不是")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("nginx.ingress.kubernetes.io/proxy-body-size: 100m\n")])])]),a("p",[e._v("需要看使用的nginx-ingress版本")]),e._v(" "),a("h2",{attrs:{id:"如何重启deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何重启deployment"}},[e._v("#")]),e._v(" 如何重启deployment")]),e._v(" "),a("p",[e._v("给容器加一个时间戳即可")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl patch deployment "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("deployment-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  -p "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{"spec":{"template":{"spec":{"containers":[{"name":"<container-name>","env":[{"name":"RESTART_","value":"\'')]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("date")]),e._v(" +%s"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'\"}]}]}}}}'")]),e._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);